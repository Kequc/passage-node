var Passage=function(){"use strict";function t(t,e){return t(e={exports:{}},e.exports),e.exports}var e=t(function(t){var e=Object.prototype.hasOwnProperty,n="~";function o(){}function i(t,e,o,i,r){if("function"!=typeof o)throw new TypeError("The listener must be a function");var s=new function(t,e,n){this.fn=t,this.context=e,this.once=n||!1}(o,i||t,r),c=n?n+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],s]:t._events[c].push(s):(t._events[c]=s,t._eventsCount++),t}function r(t,e){0==--t._eventsCount?t._events=new o:delete t._events[e]}function s(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,o,i=[];if(0===this._eventsCount)return i;for(o in t=this._events)e.call(t,o)&&i.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},s.prototype.listeners=function(t){var e=n?n+t:t,o=this._events[e];if(!o)return[];if(o.fn)return[o.fn];for(var i=0,r=o.length,s=new Array(r);i<r;i++)s[i]=o[i].fn;return s},s.prototype.listenerCount=function(t){var e=n?n+t:t,o=this._events[e];return o?o.fn?1:o.length:0},s.prototype.emit=function(t,e,o,i,r,s){var c=arguments,a=n?n+t:t;if(!this._events[a])return!1;var h,u,f=this._events[a],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,o),!0;case 4:return f.fn.call(f.context,e,o,i),!0;case 5:return f.fn.call(f.context,e,o,i,r),!0;case 6:return f.fn.call(f.context,e,o,i,r,s),!0}for(u=1,h=new Array(l-1);u<l;u++)h[u-1]=c[u];f.fn.apply(f.context,h)}else{var p,v=f.length;for(u=0;u<v;u++)switch(f[u].once&&this.removeListener(t,f[u].fn,void 0,!0),l){case 1:f[u].fn.call(f[u].context);break;case 2:f[u].fn.call(f[u].context,e);break;case 3:f[u].fn.call(f[u].context,e,o);break;case 4:f[u].fn.call(f[u].context,e,o,i);break;default:if(!h)for(p=1,h=new Array(l-1);p<l;p++)h[p-1]=c[p];f[u].fn.apply(f[u].context,h)}}return!0},s.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,o,i){var s=n?n+t:t;if(!this._events[s])return this;if(!e)return r(this,s),this;var c=this._events[s];if(c.fn)c.fn!==e||i&&!c.once||o&&c.context!==o||r(this,s);else{for(var a=0,h=[],u=c.length;a<u;a++)(c[a].fn!==e||i&&!c[a].once||o&&c[a].context!==o)&&h.push(c[a]);h.length?this._events[s]=1===h.length?h[0]:h:r(this,s)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&r(this,e)):(this._events=new o,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s}),n="2.0";return t(function(t){function e(t,e,n){if(clearTimeout(this._timeouts[t]),delete this._timeouts[t],void 0!==t&&void 0!==this._callbacks[t]){if(e){var o=new Error(e.message);o.code=e.code,o.data=e.data,this._callbacks[t](o)}else this._callbacks[t](void 0,n);delete this._callbacks[t]}}var o={INVALID:"invalid",RESPONSE:"response",NOTIFICATION:"notification"};function i(t){return"object"!=typeof t?o.INVALID:t.jsonrpc!==n?o.INVALID:void 0!==t.method?o.NOTIFICATION:void 0===t.id?o.INVALID:void 0!==t.error?o.RESPONSE:void 0!==t.result?o.RESPONSE:o.INVALID}var r=function(t,e){return"number"==typeof t?t:e};t.exports=function(t,s){return function(t){function c(e,n){void 0===n&&(n={}),t.call(this),this.uri=e,this.wsConfig=Object.assign({},n),delete this.wsConfig.requestTimeout,delete this.wsConfig.reconnect,delete this.wsConfig.reconnectTimeout,delete this.wsConfig.reconnectTries,this.requestTimeout=r(n.requestTimeout,6e3),this.reconnect=!!n.reconnect,this.reconnectTimeout=r(n.reconnectTimeout,2e3),this.reconnectTries=r(n.reconnectTries,60),this._nextId=1,this._tries=0,this._callbacks={},this._timeouts={},this.connect()}return t&&(c.__proto__=t),c.prototype=Object.create(t&&t.prototype),c.prototype.constructor=c,c.prototype.close=function(){void 0!==this.connection&&(this.connection.killed=!0,this.connection.close())},c.prototype.connect=function(){this.close(),this.connection=new s(this.uri,this.wsConfig),this.connection.on("open",function(){this._tries=0,this.emit("rpc.open")}.bind(this)),this.connection.on("close",function(){var t=this;this.reconnect&&!this.connection.killed&&this._tries<=this.reconnectTries&&(this._tries++,setTimeout(function(){t.connect()},this.reconnectTimeout)),this.emit("rpc.close")}.bind(this)),this.connection.on("error",function(t){this.emit("rpc.error",t)}.bind(this)),this.connection.on("message",function(t){var n;this.emit("rpc.message",t);try{n=JSON.parse(t),Array.isArray(n)||(n=[n])}catch(t){return}for(var r=0,s=n;r<s.length;r+=1){var c=s[r];switch(i(c)){case o.NOTIFICATION:this.emit(c.method,c.params);break;case o.RESPONSE:e.call(this,c.id,c.error,c.result)}}}.bind(this))},c.prototype.expectResponse=function(t,e){var n=this;if("function"==typeof t){var o=this._nextId++;this._callbacks[o]=t;var i=r(e,this.requestTimeout);return this._timeouts[o]=setTimeout(function(){(function(t){if(clearTimeout(this._timeouts[t]),delete this._timeouts[t],void 0!==this._callbacks[t]){var e=new Error("Timeout");e.code=408,this._callbacks[t](e),delete this._callbacks[t]}}).call(n,o)},i),o}},c.prototype.buildMessage=function(t,e,o,i){return"function"==typeof e&&(i=o,o=e,e=void 0),{id:this.expectResponse(o,i),method:t,params:e,jsonrpc:n}},c.prototype.send=function(t,e,n,o){if(1===this.connection.readyState){var i=JSON.stringify(this.buildMessage(t,e,n,o));this.connection.send(i)}else{var r=new Error("No connection");if("function"!=typeof n)throw r;n(r)}},c}(t)}})(e,WebSocket)}();
