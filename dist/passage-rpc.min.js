var Passage=function(){"use strict";function e(){}function t(){t.init.call(this)}function n(e){return void 0===e._maxListeners?t.defaultMaxListeners:e._maxListeners}function i(t,i,r,o){var s,a,c,u;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((a=t._events)?(a.newListener&&(t.emit("newListener",i,r.listener?r.listener:r),a=t._events),c=a[i]):(a=t._events=new e,t._eventsCount=0),c){if("function"==typeof c?c=a[i]=o?[r,c]:[c,r]:o?c.unshift(r):c.push(r),!c.warned&&(s=n(t))&&s>0&&c.length>s){c.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+i+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=t,f.type=i,f.count=c.length,u=f,"function"==typeof console.warn?console.warn(u):console.log(u)}}else c=a[i]=r,++t._eventsCount;return t}function r(e,t,n){var i=!1;function r(){e.removeListener(t,r),i||(i=!0,n.apply(e,arguments))}return r.listener=n,r}function o(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function s(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}e.prototype=Object.create(null),t.EventEmitter=t,t.usingDomains=!1,t.prototype.domain=void 0,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.init=function(){this.domain=null,t.usingDomains&&(!(void 0).active||this instanceof(void 0).Domain||(this.domain=(void 0).active)),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new e,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},t.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},t.prototype.getMaxListeners=function(){return n(this)},t.prototype.emit=function(e){var t,n,i,r,o,a,c,u=arguments,f="error"===e;if(a=this._events)f=f&&null==a.error;else if(!f)return!1;if(c=this.domain,f){if(t=arguments[1],!c){if(t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=c,t.domainThrown=!1,c.emit("error",t),!1}if(!(n=a[e]))return!1;var h="function"==typeof n;switch(i=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var i=e.length,r=s(e,i),o=0;o<i;++o)r[o].call(n)}(n,h,this);break;case 2:!function(e,t,n,i){if(t)e.call(n,i);else for(var r=e.length,o=s(e,r),a=0;a<r;++a)o[a].call(n,i)}(n,h,this,arguments[1]);break;case 3:!function(e,t,n,i,r){if(t)e.call(n,i,r);else for(var o=e.length,a=s(e,o),c=0;c<o;++c)a[c].call(n,i,r)}(n,h,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,i,r,o){if(t)e.call(n,i,r,o);else for(var a=e.length,c=s(e,a),u=0;u<a;++u)c[u].call(n,i,r,o)}(n,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=u[o];!function(e,t,n,i){if(t)e.apply(n,i);else for(var r=e.length,o=s(e,r),a=0;a<r;++a)o[a].apply(n,i)}(n,h,this,r)}return!0},t.prototype.addListener=function(e,t){return i(this,e,t,!1)},t.prototype.on=t.prototype.addListener,t.prototype.prependListener=function(e,t){return i(this,e,t,!0)},t.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,r(this,e,t)),this},t.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,r(this,e,t)),this},t.prototype.removeListener=function(t,n){var i,r,o,s,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[t]))return this;if(i===n||i.listener&&i.listener===n)0==--this._eventsCount?this._events=new e:(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||n));else if("function"!=typeof i){for(o=-1,s=i.length;s-- >0;)if(i[s]===n||i[s].listener&&i[s].listener===n){a=i[s].listener,o=s;break}if(o<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new e,this;delete r[t]}else!function(e,t){for(var n=t,i=n+1,r=e.length;i<r;n+=1,i+=1)e[n]=e[i];e.pop()}(i,o);r.removeListener&&this.emit("removeListener",t,a||n)}return this},t.prototype.removeAllListeners=function(t){var n,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new e,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new e:delete i[t]),this;if(0===arguments.length){for(var r,o=Object.keys(i),s=0;s<o.length;++s)"removeListener"!==(r=o[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new e,this._eventsCount=0,this}if("function"==typeof(n=i[t]))this.removeListener(t,n);else if(n)do{this.removeListener(t,n[n.length-1])}while(n[0]);return this},t.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},t.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):o.call(e,t)},t.prototype.listenerCount=o,t.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var a=Object.freeze({default:t,EventEmitter:t});function c(e){var t=new Error(e.message);return t.name=e.name,t.code=e.code,t.data=e.data,t}var u,f={toJSON:function(e){return{message:e.message,name:e.name,code:e.code,data:e.data}},timeout:function(e){return c({code:408,name:"Timeout",message:"Timeout",data:e})},serviceUnavailable:function(e){return c({code:503,name:"ServiceUnavailable",message:"Service unavailable",data:e})},parseError:function(e){return c({code:-32700,name:"ParseError",message:"Parse error",data:e})},invalidRequest:function(e){return c({code:-32600,name:"InvalidRequest",message:"Invalid request",data:e})},methodNotFound:function(e){return c({code:-32601,name:"MethodNotFound",message:"Method not found",data:e})},invalidParams:function(e){return c({code:-32602,name:"InvalidParams",message:"Invalid params",data:e})},internalError:function(e){return c({code:-32603,name:"InternalError",message:"Internal error",data:e})}},l="2.0",h=a&&t||a,p=(function(e){function t(e,t,n){if(clearTimeout(this._timeouts[e]),delete this._timeouts[e],void 0!==e&&void 0!==this._callbacks[e]){if(t){var i=new Error(t.message);i.name=t.name,i.code=t.code,i.data=t.data,this._callbacks[e](i)}else this._callbacks[e](void 0,n);delete this._callbacks[e]}}function n(e){this.emit("rpc.message",e);for(var n=0,i=function(e){try{var t=JSON.parse(e);return Array.isArray(t)?t:[t]}catch(e){return[]}}(e);n<i.length;n+=1){var r=i[n];"object"==typeof r&&(r.jsonrpc===l&&(void 0!==r.method?this.emit(r.method,r.params):void 0!==r.id&&t.call(this,r.id,r.error,r.result)))}}var i=function(e,t){return"number"==typeof e?e:t};e.exports=function(e){var t=function(t){function r(e,n){void 0===n&&(n={}),t.call(this),this.uri=e,this.options={requestTimeout:i(n.requestTimeout,6e3),reconnect:!!n.reconnect,reconnectTimeout:i(n.reconnectTimeout,2e3),reconnectTries:i(n.reconnectTries,60)},this._nextId=1,this._tries=0,this._callbacks={},this._timeouts={},this.connect()}t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r;var o={statusCode:{configurable:!0}};return o.statusCode.get=function(){return this.connection.statusCode},r.prototype.close=function(){void 0!==this.connection&&(this.connection.killed=!0,this.connection.close())},r.prototype.connect=function(){this.close(),this.connection=new e(this.uri),this.connection.on("open",function(){this._tries=0,this.emit("rpc.open")}.bind(this)),this.connection.on("close",function(){var e=this;this.options.reconnect&&!this.connection.killed&&this._tries<=this.options.reconnectTries&&(this._tries++,setTimeout(function(){e.connect()},this.options.reconnectTimeout)),this.emit("rpc.close")}.bind(this)),this.connection.on("error",function(e){this.emit("rpc.error",e)}.bind(this)),this.connection.on("message",n.bind(this))},r.prototype.expectResponse=function(e,t){var n=this;if("function"==typeof e){var r=this._nextId++;this._callbacks[r]=e;var o=i(t,this.options.requestTimeout);return this._timeouts[r]=setTimeout(function(){(function(e){clearTimeout(this._timeouts[e]),delete this._timeouts[e],void 0!==e&&void 0!==this._callbacks[e]&&(this._callbacks[e](f.timeout({info:"Server did not respond in time."})),delete this._callbacks[e])}).call(n,r)},o),r}},r.prototype.buildMessage=function(e,t,n,i){return"function"==typeof t&&(i=n,n=t,t=void 0),{id:this.expectResponse(n,i),method:e,params:t,jsonrpc:l}},r.prototype.send=function(e,t,n,i){if(this.connection.readyState===r.OPEN){var o=JSON.stringify(this.buildMessage(e,t,n,i));this.connection.send(o)}else{var s=s.serviceUnavailable({info:"Connection not available."});if("function"==typeof t&&(n=t),"function"!=typeof n)throw s;n(s)}},Object.defineProperties(r.prototype,o),r}(h);return t.CONNECTING=0,t.OPEN=1,t.CLOSING=2,t.CLOSED=3,t}}(u={exports:{}},u.exports),u.exports)(WebSocket);return WebSocket.prototype.on=function(e,t){this.addEventListener(e,function(e){var n=e.data;t(n)})},p}();
