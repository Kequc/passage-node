var Passage=function(){"use strict";function e(){}function t(){t.init.call(this)}function n(e){return void 0===e._maxListeners?t.defaultMaxListeners:e._maxListeners}function i(t,i,r,o){var s,c,u,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((c=t._events)?(c.newListener&&(t.emit("newListener",i,r.listener?r.listener:r),c=t._events),u=c[i]):(c=t._events=new e,t._eventsCount=0),u){if("function"==typeof u?u=c[i]=o?[r,u]:[u,r]:o?u.unshift(r):u.push(r),!u.warned&&(s=n(t))&&s>0&&u.length>s){u.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+i+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=i,h.count=u.length,a=h,"function"==typeof console.warn?console.warn(a):console.log(a)}}else u=c[i]=r,++t._eventsCount;return t}function r(e,t,n){var i=!1;function r(){e.removeListener(t,r),i||(i=!0,n.apply(e,arguments))}return r.listener=n,r}function o(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function s(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}e.prototype=Object.create(null),t.EventEmitter=t,t.usingDomains=!1,t.prototype.domain=void 0,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.init=function(){this.domain=null,t.usingDomains&&(!(void 0).active||this instanceof(void 0).Domain||(this.domain=(void 0).active)),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new e,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},t.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},t.prototype.getMaxListeners=function(){return n(this)},t.prototype.emit=function(e){var t,n,i,r,o,c,u,a=arguments,h="error"===e;if(c=this._events)h=h&&null==c.error;else if(!h)return!1;if(u=this.domain,h){if(t=arguments[1],!u){if(t instanceof Error)throw t;var f=new Error('Uncaught, unspecified "error" event. ('+t+")");throw f.context=t,f}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=u,t.domainThrown=!1,u.emit("error",t),!1}if(!(n=c[e]))return!1;var l="function"==typeof n;switch(i=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var i=e.length,r=s(e,i),o=0;o<i;++o)r[o].call(n)}(n,l,this);break;case 2:!function(e,t,n,i){if(t)e.call(n,i);else for(var r=e.length,o=s(e,r),c=0;c<r;++c)o[c].call(n,i)}(n,l,this,arguments[1]);break;case 3:!function(e,t,n,i,r){if(t)e.call(n,i,r);else for(var o=e.length,c=s(e,o),u=0;u<o;++u)c[u].call(n,i,r)}(n,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,i,r,o){if(t)e.call(n,i,r,o);else for(var c=e.length,u=s(e,c),a=0;a<c;++a)u[a].call(n,i,r,o)}(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=a[o];!function(e,t,n,i){if(t)e.apply(n,i);else for(var r=e.length,o=s(e,r),c=0;c<r;++c)o[c].apply(n,i)}(n,l,this,r)}return!0},t.prototype.addListener=function(e,t){return i(this,e,t,!1)},t.prototype.on=t.prototype.addListener,t.prototype.prependListener=function(e,t){return i(this,e,t,!0)},t.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,r(this,e,t)),this},t.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,r(this,e,t)),this},t.prototype.removeListener=function(t,n){var i,r,o,s,c;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[t]))return this;if(i===n||i.listener&&i.listener===n)0==--this._eventsCount?this._events=new e:(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||n));else if("function"!=typeof i){for(o=-1,s=i.length;s-- >0;)if(i[s]===n||i[s].listener&&i[s].listener===n){c=i[s].listener,o=s;break}if(o<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new e,this;delete r[t]}else!function(e,t){for(var n=t,i=n+1,r=e.length;i<r;n+=1,i+=1)e[n]=e[i];e.pop()}(i,o);r.removeListener&&this.emit("removeListener",t,c||n)}return this},t.prototype.removeAllListeners=function(t){var n,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new e,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new e:delete i[t]),this;if(0===arguments.length){for(var r,o=Object.keys(i),s=0;s<o.length;++s)"removeListener"!==(r=o[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new e,this._eventsCount=0,this}if("function"==typeof(n=i[t]))this.removeListener(t,n);else if(n)do{this.removeListener(t,n[n.length-1])}while(n[0]);return this},t.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},t.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):o.call(e,t)},t.prototype.listenerCount=o,t.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var c,u=Object.freeze({default:t,EventEmitter:t}),a="2.0",h=u&&t||u,f=(function(e){function t(e,t,n){if(clearTimeout(this._timeouts[e]),delete this._timeouts[e],void 0!==e&&void 0!==this._callbacks[e]){if(t){var i=new Error(t.message);i.code=t.code,i.data=t.data,this._callbacks[e](i)}else this._callbacks[e](void 0,n);delete this._callbacks[e]}}function n(e){this.emit("rpc.message",e);for(var n=0,i=function(e){try{var t=JSON.parse(e);return Array.isArray(t)?t:[t]}catch(e){return[]}}(e);n<i.length;n+=1){var r=i[n];"object"==typeof r&&(r.jsonrpc===a&&(void 0!==r.method?this.emit(r.method,r.params):void 0!==r.id&&t.call(this,r.id,r.error,r.result)))}}var i=function(e,t){return"number"==typeof e?e:t};e.exports=function(e){var t=function(t){function r(e,n){void 0===n&&(n={}),t.call(this),this.uri=e,this.options={requestTimeout:i(n.requestTimeout,6e3),reconnect:!!n.reconnect,reconnectTimeout:i(n.reconnectTimeout,2e3),reconnectTries:i(n.reconnectTries,60)},this._nextId=1,this._tries=0,this._callbacks={},this._timeouts={},this.connect()}t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r;var o={statusCode:{configurable:!0}};return o.statusCode.get=function(){return this.connection.statusCode},r.prototype.close=function(){void 0!==this.connection&&(this.connection.killed=!0,this.connection.close())},r.prototype.connect=function(){this.close(),this.connection=new e(this.uri),this.connection.on("open",function(){this._tries=0,this.emit("rpc.open")}.bind(this)),this.connection.on("close",function(){var e=this;this.options.reconnect&&!this.connection.killed&&this._tries<=this.options.reconnectTries&&(this._tries++,setTimeout(function(){e.connect()},this.options.reconnectTimeout)),this.emit("rpc.close")}.bind(this)),this.connection.on("error",function(e){this.emit("rpc.error",e)}.bind(this)),this.connection.on("message",n.bind(this))},r.prototype.expectResponse=function(e,t){var n=this;if("function"==typeof e){var r=this._nextId++;this._callbacks[r]=e;var o=i(t,this.options.requestTimeout);return this._timeouts[r]=setTimeout(function(){(function(e){if(clearTimeout(this._timeouts[e]),delete this._timeouts[e],void 0!==this._callbacks[e]){var t=new Error("Timeout");t.code=408,this._callbacks[e](t),delete this._callbacks[e]}}).call(n,r)},o),r}},r.prototype.buildMessage=function(e,t,n,i){return"function"==typeof t&&(i=n,n=t,t=void 0),{id:this.expectResponse(n,i),method:e,params:t,jsonrpc:a}},r.prototype.send=function(e,t,n,i){if(this.connection.readyState===r.OPEN){var o=JSON.stringify(this.buildMessage(e,t,n,i));this.connection.send(o)}else{var s=new Error("No connection");if("function"!=typeof n)throw s;n(s)}},Object.defineProperties(r.prototype,o),r}(h);return t.CONNECTING=0,t.OPEN=1,t.CLOSING=2,t.CLOSED=3,t}}(c={exports:{}},c.exports),c.exports)(WebSocket);return WebSocket.prototype.on=WebSocket.prototype.addEventListener,f}();
