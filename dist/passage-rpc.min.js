var Passage=function(){"use strict";function e(e,t){return e(t={exports:{}},t.exports),t.exports}function t(){}function n(){n.init.call(this)}function i(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function r(e,n,r,o){var s,a,c,u;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",n,r.listener?r.listener:r),a=e._events),c=a[n]):(a=e._events=new t,e._eventsCount=0),c){if("function"==typeof c?c=a[n]=o?[r,c]:[c,r]:o?c.unshift(r):c.push(r),!c.warned&&(s=i(e))&&s>0&&c.length>s){c.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=e,f.type=n,f.count=c.length,u=f,"function"==typeof console.warn?console.warn(u):console.log(u)}}else c=a[n]=r,++e._eventsCount;return e}function o(e,t,n){var i=!1;function r(){e.removeListener(t,r),i||(i=!0,n.apply(e,arguments))}return r.listener=n,r}function s(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function a(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}t.prototype=Object.create(null),n.EventEmitter=n,n.usingDomains=!1,n.prototype.domain=void 0,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.init=function(){this.domain=null,n.usingDomains&&(!(void 0).active||this instanceof(void 0).Domain||(this.domain=(void 0).active)),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new t,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return i(this)},n.prototype.emit=function(e){var t,n,i,r,o,s,c,u=arguments,f="error"===e;if(s=this._events)f=f&&null==s.error;else if(!f)return!1;if(c=this.domain,f){if(t=arguments[1],!c){if(t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=c,t.domainThrown=!1,c.emit("error",t),!1}if(!(n=s[e]))return!1;var h="function"==typeof n;switch(i=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var i=e.length,r=a(e,i),o=0;o<i;++o)r[o].call(n)}(n,h,this);break;case 2:!function(e,t,n,i){if(t)e.call(n,i);else for(var r=e.length,o=a(e,r),s=0;s<r;++s)o[s].call(n,i)}(n,h,this,arguments[1]);break;case 3:!function(e,t,n,i,r){if(t)e.call(n,i,r);else for(var o=e.length,s=a(e,o),c=0;c<o;++c)s[c].call(n,i,r)}(n,h,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,i,r,o){if(t)e.call(n,i,r,o);else for(var s=e.length,c=a(e,s),u=0;u<s;++u)c[u].call(n,i,r,o)}(n,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=u[o];!function(e,t,n,i){if(t)e.apply(n,i);else for(var r=e.length,o=a(e,r),s=0;s<r;++s)o[s].apply(n,i)}(n,h,this,r)}return!0},n.prototype.addListener=function(e,t){return r(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return r(this,e,t,!0)},n.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,o(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,o(this,e,t)),this},n.prototype.removeListener=function(e,n){var i,r,o,s,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[e]))return this;if(i===n||i.listener&&i.listener===n)0==--this._eventsCount?this._events=new t:(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||n));else if("function"!=typeof i){for(o=-1,s=i.length;s-- >0;)if(i[s]===n||i[s].listener&&i[s].listener===n){a=i[s].listener,o=s;break}if(o<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new t,this;delete r[e]}else!function(e,t){for(var n=t,i=n+1,r=e.length;i<r;n+=1,i+=1)e[n]=e[i];e.pop()}(i,o);r.removeListener&&this.emit("removeListener",e,a||n)}return this},n.prototype.removeAllListeners=function(e){var n,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new t,this._eventsCount=0):i[e]&&(0==--this._eventsCount?this._events=new t:delete i[e]),this;if(0===arguments.length){for(var r,o=Object.keys(i),s=0;s<o.length;++s)"removeListener"!==(r=o[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new t,this._eventsCount=0,this}if("function"==typeof(n=i[e]))this.removeListener(e,n);else if(n)do{this.removeListener(e,n[n.length-1])}while(n[0]);return this},n.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):s.call(e,t)},n.prototype.listenerCount=s,n.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var c=Object.freeze({default:n,EventEmitter:n}),u=e(function(e){var t={build:function(e){var t=new Error(e.message);return t.name=e.name,t.code=e.code,t.data=e.data,t},toJSON:function(e){return{message:e.message,name:e.name,code:e.code,data:e.data}},timeout:function(e){return t.build({code:408,name:"Timeout",message:"Timeout",data:e})},serviceUnavailable:function(e){return t.build({code:503,name:"ServiceUnavailable",message:"Service unavailable",data:e})},parseError:function(e){return t.build({code:-32700,name:"ParseError",message:"Parse error",data:e})},invalidRequest:function(e){return t.build({code:-32600,name:"InvalidRequest",message:"Invalid request",data:e})},methodNotFound:function(e){return t.build({code:-32601,name:"MethodNotFound",message:"Method not found",data:e})},invalidParams:function(e){return t.build({code:-32602,name:"InvalidParams",message:"Invalid params",data:e})},internalError:function(e){return t.build({code:-32603,name:"InternalError",message:"Internal error",data:e})}};e.exports=t});function f(e){return"object"!=typeof e?null:"number"!=typeof e.id&&"string"!=typeof e.id?null:e.id}var l=function(e){try{this.parsed=JSON.parse(e)}catch(e){}},h={isArray:{configurable:!0},requests:{configurable:!0},ids:{configurable:!0}};h.isArray.get=function(){return Array.isArray(this.parsed)},l.prototype.error=function(){return this.parsed?this.isArray&&this.parsed.length<1?u.invalidRequest():void 0:u.parseError()},h.requests.get=function(){return this.isArray?this.parsed:[this.parsed]},h.ids.get=function(){return this.requests.map(f)},Object.defineProperties(l.prototype,h);var p=l,d="2.0",v=c&&n||c;return e(function(e){function t(e,t,n){clearTimeout(this._timeouts[e]),delete this._timeouts[e],void 0!==e&&void 0!==this._callbacks[e]&&(t?this._callbacks[e](u.build(t)):this._callbacks[e](void 0,n),delete this._callbacks[e])}var n=function(e,t){return"number"==typeof e?e:t};e.exports=function(e){var i=function(i){function r(e,t){void 0===t&&(t={}),i.call(this),this.uri=e,this.options={requestTimeout:n(t.requestTimeout,6e3),reconnect:!!t.reconnect,reconnectTimeout:n(t.reconnectTimeout,2e3),reconnectTries:n(t.reconnectTries,60)},this._nextId=1,this._tries=0,this._callbacks={},this._timeouts={},this.connect()}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var o={readyState:{configurable:!0}};return o.readyState.get=function(){return this.connection.readyState},r.prototype.close=function(){void 0!==this.connection&&(this.connection.killed=!0,this.connection.close())},r.prototype.connect=function(){this.close(),this.connection=new e(this.uri),"function"!=typeof this.connection.on&&(this.connection.on=function(e,t){this.addEventListener(e,function(e){t(e.data)})}),this.connection.on("open",function(){this._tries=0,this.emit("rpc.open")}.bind(this)),this.connection.on("close",function(){var e=this;this.options.reconnect&&!this.connection.killed&&this._tries<=this.options.reconnectTries&&(this._tries++,setTimeout(function(){e.connect()},this.options.reconnectTimeout)),this.emit("rpc.close")}.bind(this)),this.connection.on("error",function(e){this.emit("rpc.error",e)}.bind(this)),this.connection.on("message",function(e){this.emit("rpc.message",e);var n=new p(e);if(!n.error())for(var i=0,r=n.requests;i<r.length;i+=1){var o=r[i];"object"==typeof o&&o.jsonrpc===d&&("string"==typeof o.method?this.emit(o.method,o.params):void 0!==o.id&&t.call(this,o.id,o.error,o.result))}}.bind(this))},r.prototype.expectResponse=function(e,t){var i=this;if("function"==typeof e){var r=this._nextId++;this._callbacks[r]=e;var o=n(t,this.options.requestTimeout);return this._timeouts[r]=setTimeout(function(){(function(e){clearTimeout(this._timeouts[e]),delete this._timeouts[e],void 0!==e&&void 0!==this._callbacks[e]&&(this._callbacks[e](u.timeout({info:"Server did not respond in time."})),delete this._callbacks[e])}).call(i,r)},o),r}},r.prototype.buildMessage=function(e,t,n,i){return"function"==typeof t&&(i=n,n=t,t=void 0),{id:this.expectResponse(n,i),method:e,params:t,jsonrpc:d}},r.prototype.send=function(e,t,n,i){if(1===this.readyState){var r=JSON.stringify(this.buildMessage(e,t,n,i));this.connection.send(r)}else{var o=u.serviceUnavailable({info:"Connection not available."});if("function"==typeof t&&(n=t),"function"!=typeof n)throw o;n(o)}},Object.defineProperties(r.prototype,o),r}(v);return i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i}})(WebSocket)}();
